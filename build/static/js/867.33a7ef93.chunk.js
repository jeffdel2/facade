"use strict";(self.webpackChunkreact_niq_app=self.webpackChunkreact_niq_app||[]).push([[867],{4867:(e,s,t)=>{t.r(s),t.d(s,{default:()=>k});var a=t(9950),r=t(134),n=t(7321),o=t(5342),i=t(8506),l=t(5547),d=t(5310),c=t(1521),u=t(2036),x=t(6615),h=t(6060),p=t(4514),m=t(6057),g=t(7070),b=t(6240),f=t(6812),j=t(9737),A=t(5060),v=t(6309),y=t(1672),w=t(7356),C=t(4414);const P=e=>{let{icon:s,label:t,value:a}=e;return(0,C.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1.5,p:2,backgroundColor:"rgba(0, 0, 0, 0.02)",borderRadius:2},children:[(0,C.jsx)(n.A,{sx:{color:"primary.main"},children:s}),(0,C.jsxs)(n.A,{children:[(0,C.jsx)(o.A,{variant:"body2",color:"text.secondary",children:t}),(0,C.jsx)(o.A,{variant:"subtitle1",fontWeight:"medium",children:a})]})]})},k=()=>{const{user:e,isAuthenticated:s,isLoading:t,getAccessTokenSilently:k}=(0,r.WB)(),S=(0,w.A)(),[T,$]=(0,a.useState)(!1),[E,W]=(0,a.useState)(!1),[_,D]=(0,a.useState)({open:!1,message:"",severity:"success"}),[I,M]=(0,a.useState)({address:"",phone:"",birthdate:"",preferences:{notifications:!0,newsletter:!0}});(0,a.useEffect)(()=>{null!==e&&void 0!==e&&e.sub&&(async()=>{try{const s=await k(),t=g.A.auth0.mgmtDomain,a=`https://${t}/userinfo`;console.log("Fetching metadata from:",a),console.log("User sub:",null===e||void 0===e?void 0:e.sub),console.log("Management domain:",t);const r=await fetch(a,{headers:{access_token:`${s}`}});if(console.log("Response status:",r.status),console.log("Response headers:",Object.fromEntries(r.headers.entries())),!r.ok){const e=await r.text();throw console.log("Error response:",e),new Error(`HTTP error! status: ${r.status}`)}const n=await r.json();console.log("Full response data:",n);const{user_metadata:o}=n;console.log("User metadata:",o),o?M(o):console.log("No user_metadata found in response")}catch(s){console.error("Error fetching user metadata:",s),M({address:"",phone:"",birthdate:"",preferences:{notifications:!0,newsletter:!0}})}})()},[k,null===e||void 0===e?void 0:e.sub]);if(t)return(0,C.jsx)(n.A,{sx:{width:"100%",mt:4},children:(0,C.jsx)(i.A,{})});if(!s||!e)return(0,C.jsx)(n.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:(0,C.jsx)(o.A,{variant:"h6",color:"text.secondary",children:"Please log in to view your profile."})});const N={points:1250,status:"Gold Member",memberSince:"January 2024",lastPurchase:"March 15, 2024",progress:75,pointsToNext:250};return(0,C.jsxs)(n.A,{sx:{maxWidth:1200,mx:"auto",p:{xs:2,md:4}},children:[(0,C.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:4},children:[(0,C.jsx)(l.A,{sx:{position:"relative",overflow:"visible",background:`linear-gradient(45deg, ${S.palette.primary.main}, ${S.palette.secondary.main})`,color:"white",p:2},children:(0,C.jsxs)(n.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center",sm:"flex-start"},gap:3,position:"relative",zIndex:1},children:[(0,C.jsx)(d.A,{src:e.picture,alt:e.name,sx:{width:120,height:120,border:"4px solid white",boxShadow:2}}),(0,C.jsxs)(n.A,{sx:{flex:1,textAlign:{xs:"center",sm:"left"}},children:[(0,C.jsx)(o.A,{variant:"h4",gutterBottom:!0,fontWeight:"bold",children:e.name}),(0,C.jsx)(o.A,{variant:"body1",sx:{opacity:.9},children:e.email}),(0,C.jsx)(c.A,{label:N.status,sx:{mt:1,backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white","& .MuiChip-label":{fontWeight:"medium"}}})]})]})}),(0,C.jsxs)(n.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)"},gap:2},children:[(0,C.jsx)(P,{icon:(0,C.jsx)(b.A,{}),label:"Reward Points",value:N.points.toLocaleString()}),(0,C.jsx)(P,{icon:(0,C.jsx)(f.A,{}),label:"Member Status",value:N.status}),(0,C.jsx)(P,{icon:(0,C.jsx)(j.A,{}),label:"Member Since",value:N.memberSince}),(0,C.jsx)(P,{icon:(0,C.jsx)(A.A,{}),label:"Last Purchase",value:N.lastPurchase})]}),(0,C.jsx)(l.A,{children:(0,C.jsxs)(u.A,{children:[(0,C.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Progress to Next Tier"}),(0,C.jsxs)(n.A,{sx:{mt:2},children:[(0,C.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,C.jsxs)(o.A,{variant:"body2",color:"text.secondary",children:["Current: ",N.status]}),(0,C.jsxs)(o.A,{variant:"body2",color:"text.secondary",children:[N.pointsToNext," points to next tier"]})]}),(0,C.jsx)(i.A,{variant:"determinate",value:N.progress,sx:{height:8,borderRadius:4,backgroundColor:"rgba(0, 0, 0, 0.04)","& .MuiLinearProgress-bar":{borderRadius:4}}})]})]})}),(0,C.jsx)(l.A,{children:(0,C.jsxs)(u.A,{children:[(0,C.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,C.jsx)(o.A,{variant:"h6",children:"Profile Details"}),(0,C.jsx)(x.A,{startIcon:T?(0,C.jsx)(v.A,{}):(0,C.jsx)(y.A,{}),variant:T?"contained":"outlined",onClick:T?async()=>{W(!0);try{const s=await k(),t=`https://${g.A.auth0.mgmtDomain}/api/v2/users/${null===e||void 0===e?void 0:e.sub}`,a=await fetch(t,{method:"PATCH",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({user_metadata:I})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);D({open:!0,message:"Profile updated successfully!",severity:"success"}),$(!1)}catch(s){console.error("Error updating user metadata:",s),D({open:!0,message:"Failed to update profile. Please try again.",severity:"error"})}finally{W(!1)}}:()=>$(!0),disabled:E,children:T?E?"Saving...":"Save Changes":"Edit Profile"})]}),(0,C.jsxs)(n.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:3},children:[(0,C.jsx)(h.A,{fullWidth:!0,label:"Address",value:I.address||"",onChange:e=>M(s=>({...s,address:e.target.value})),disabled:!T,margin:"normal"}),(0,C.jsx)(h.A,{fullWidth:!0,label:"Phone Number",value:I.phone||"",onChange:e=>M(s=>({...s,phone:e.target.value})),disabled:!T,margin:"normal"}),(0,C.jsx)(h.A,{fullWidth:!0,label:"Birth Date",type:"date",value:I.birthdate||"",onChange:e=>M(s=>({...s,birthdate:e.target.value})),disabled:!T,margin:"normal",InputLabelProps:{shrink:!0}})]})]})})]}),(0,C.jsx)(p.A,{open:_.open,autoHideDuration:6e3,onClose:()=>D(e=>({...e,open:!1})),children:(0,C.jsx)(m.A,{onClose:()=>D(e=>({...e,open:!1})),severity:_.severity,sx:{width:"100%"},children:_.message})})]})}}}]);